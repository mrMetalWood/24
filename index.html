<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Jackpot 24</title>
    <meta name="viewport" content="width=device-width" />
    <meta
      name="viewport"
      content="initial-scale=1, maximum-scale=1, user-scalable=no"
    />

    <link
      href="https://fonts.googleapis.com/css?family=Mountains+of+Christmas"
      rel="stylesheet"
    />

    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
    <link rel="manifest" href="site.webmanifest" />
    <link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ee9ca7" />

    <style media="screen">
      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      @font-face {
        font-family: "Jackport";
        src: url("fonts/jackport.woff2") format("woff2"),
          url("fonts/jackport.woff") format("woff");
      }

      html,
      body {
        padding: 0;
        margin: 0;
        font-family: "Jackport";
      }

      .container {
        width: 100vw;
        height: 100vh;
        padding: 16px;
        background: linear-gradient(#d3959b, #bfe6ba);
      }

      .grid {
        width: 100%;
        height: 100%;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(7, 1fr);
        grid-gap: 8px;
      }

      .day {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10vw;
        border-radius: 3px;
        border: 1px solid black;
        background-size: cover;
        background-position: center;
      }

      .header {
        grid-column: span 4;
        text-transform: uppercase;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 8px;
      }

      .title {
        font-size: 70px;
      }

      .winnings {
        font-size: 40px;
      }

      .eth {
        font-family: Arial, Helvetica, sans-serif;
      }

      .lightbox-overlay {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        background: rgba(0, 0, 0, 0.75);
      }

      .lightbox-container {
        position: absolute;
        top: 20px;
        right: 20px;
        bottom: 20px;
        left: 20px;
        background: deeppink;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(#ee9ca7, #ffdde1);
      }

      .lightbox-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-55%, -50%) rotate(90deg);
        font-size: 350px;
        z-index: 5;
        color: #151c2f;
      }

      .sc__canvas {
        z-index: 10;
      }

      .hide {
        display: none;
      }

      .progress {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 10px;
        transform: translateX(-100%);
        background: dodgerblue;
      }

      .invalid {
        animation: shake 0.5s linear;
      }

      @keyframes shake {
        0% {
          transform: translate(0);
        }
        20% {
          transform: translate(10px);
        }
        40% {
          transform: translate(-10px);
        }
        60% {
          transform: translate(10px);
        }
        80% {
          transform: translate(-10px);
        }
        100% {
          transform: translate(0);
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="lightbox-overlay hide">
        <div class="progress"></div>
        <div class="lightbox-container"></div>
      </div>
      <div class="sc"></div>
      <div class="grid">
        <div class="header">
          <span class="title">Jackpot 24</span>
          <span class="winnings"
            >Total: <span class="eth">Îž</span>
            <span class="total-value">0</span></span
          >
        </div>
        <div class="day" data-id="3" data-value="0.052">
          <span>3</span>
        </div>
        <div class="day" data-id="24" data-value="0.111">
          <span>24</span>
        </div>
        <div class="day" data-id="5" data-value="0.083">
          <span>5</span>
        </div>
        <div class="day" data-id="1" data-value="0.002">
          <span>1</span>
        </div>
        <div class="day" data-id="7" data-value="0.012">
          <span>7</span>
        </div>
        <div class="day" data-id="10" data-value="0.033">
          <span>10</span>
        </div>
        <div class="day" data-id="14" data-value="0.017">
          <span>14</span>
        </div>
        <div class="day" data-id="20" data-value="0.004">
          <span>20</span>
        </div>
        <div class="day" data-id="16" data-value="0.059">
          <span>16</span>
        </div>
        <div class="day" data-id="21" data-value="0.048">
          <span>21</span>
        </div>
        <div class="day" data-id="4" data-value="0.009">
          <span>4</span>
        </div>
        <div class="day" data-id="8" data-value="0.017">
          <span>8</span>
        </div>
        <div class="day" data-id="11" data-value="0.031">
          <span>11</span>
        </div>
        <div class="day" data-id="22" data-value="0.02">
          <span>22</span>
        </div>
        <div class="day" data-id="12" data-value="0.105">
          <span>12</span>
        </div>
        <div class="day" data-id="6" data-value="0.025">
          <span>6</span>
        </div>
        <div class="day" data-id="18" data-value="0.003">
          <span>18</span>
        </div>
        <div class="day" data-id="13" data-value="0.22">
          <span>13</span>
        </div>
        <div class="day" data-id="2" data-value="0.044">
          <span>2</span>
        </div>
        <div class="day" data-id="23" data-value="0.019">
          <span>23</span>
        </div>
        <div class="day" data-id="17" data-value="0.037">
          <span>17</span>
        </div>
        <div class="day" data-id="15" data-value="0.007">
          <span>15</span>
        </div>
        <div class="day" data-id="19" data-value="0.003">
          <span>19</span>
        </div>
        <div class="day" data-id="9" data-value="0.039">
          <span>9</span>
        </div>
      </div>
    </div>

    <script src="scratchcard.min.js"></script>

    <script type="text/javascript">
      const PERCENT_TO_FINISH = 50;

      const lightBox = document.querySelector(".lightbox-overlay");
      const progress = document.querySelector(".progress");
      const totalValue = document.querySelector(".total-value");
      const days = [...document.querySelectorAll(".day")];

      let db = JSON.parse(localStorage.getItem("jackpot24") || "[]");

      const alreadySolved = (day) => {
        return db.find((item) => item.id === day.dataset.id);
      };

      const updateView = () => {
        db = JSON.parse(localStorage.getItem("jackpot24") || "[]");
        let total = 0;
        const solvedDays = days.filter((day) => alreadySolved(day));
        solvedDays.forEach((day) => {
          day.querySelector("span").textContent = Number(
            day.dataset.value
          ).toFixed(3);
          day.style.backgroundImage = `url(/images/eth${day.dataset.id}.png)`;
          day.style.color = "white";
          day.style["-webkit-text-stroke"] = "2px black";
          total += Number(day.dataset.value);
        });

        totalValue.textContent = total.toFixed(3);
      };

      updateView();

      days
        .filter((day) => !alreadySolved(day))
        .forEach((day) => {
          day.addEventListener("click", (event) => {
            const now = Date.parse(new Date());
            // const now = Date.parse("2020-12-29T00:00:00Z");
            const d = event.currentTarget;
            const dayNumber = Number(d.dataset.id);
            const dayMs = Date.parse(
              `2020-12-${`0${dayNumber}`.slice(-2)}T00:00:00Z`
            );

            if (now - dayMs >= 0) {
              lightBox.classList.remove("hide");
              const scContainer = document.querySelector(".lightbox-container");
              const sc = new ScratchCard(".lightbox-container", {
                scratchType: SCRATCH_TYPE.BRUSH,
                containerWidth: scContainer.offsetWidth,
                containerHeight: scContainer.offsetHeight,
                imageForwardSrc: `images/eth${dayNumber}.png`,
                htmlBackground: `<div class="lightbox-text">${d.dataset.value}</div>`,
                clearZoneRadius: 5,
                percentToFinish: PERCENT_TO_FINISH,
                brushSrc:
                  "data:image/png;base64,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",

                callback: function () {
                  localStorage.setItem(
                    "jackpot24",
                    JSON.stringify([
                      ...db,
                      {id: day.dataset.id, value: day.dataset.value},
                    ])
                  );

                  updateView();

                  lightBox.classList.add("hide");
                  const el = document.querySelector(
                    `[data-id="${day.dataset.id}"]`
                  );
                  const elClone = el.cloneNode(true);
                  el.parentNode.replaceChild(elClone, el);
                  scContainer.innerHTML = "";
                  progress.style.transform = `translateX(-100%)`;
                },
              });

              sc.init().then(() => {
                sc.canvas.addEventListener("scratch.move", () => {
                  let percent = sc.getPercent().toFixed(2);

                  progress.style.transform = `translateX(-${
                    100 - (percent / PERCENT_TO_FINISH) * 100
                  }%)`;
                });
              });
            } else {
              day.classList.add("invalid");
              setTimeout(() => {
                day.classList.remove("invalid");
              }, 500);
            }
          });
        });
    </script>
  </body>
</html>
